# INFO:
#   This is a playbook with tests to execute after
#   the role is applied to image
---

- name: VERIFY
  hosts: all

  pre_tasks:

    - name: VERIFY | Add CENTOS packages
      become: true
      yum:
        name: "{{ item }}"
        state: present
      loop:
        - epel-release
      when: ansible_distribution | lower == 'centos'

    - name: VERIFY | Add common packages
      become: true
      package:
        name: "{{ item }}"
        state: present
      loop:
        - jq

  tasks:

    - name: VERIFY | Copy script(s)
      copy:
        src: "../scripts/{{ item }}"
        dest: "/tmp/{{ item }}"
        owner: root
        group: root
        mode: '0644'
      loop:
        - test-1.sh
      when: false

    - name: VERIFY | Run scripts
      script:
        cmd: "{{ item }}"
      register: script_output
      loop:
        - ../scripts/vault-init.sh

    - debug:
        var: script_output.results[0].stdout_lines
